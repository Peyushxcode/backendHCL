<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>StoryGen Test UI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: system-ui, sans-serif; max-width: 960px; margin: 24px auto; padding: 0 16px; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
      textarea, select, input, button { width: 100%; padding: 10px; font-size: 16px; }
      .scenes { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; margin-top: 24px; }
      .card { border: 1px solid #ddd; border-radius: 8px; padding: 12px; }
      .img { width: 100%; border-radius: 6px; background: #f5f5f5; }
      .muted { color: #666; font-size: 14px; }
    </style>
  </head>
  <body>
    <h1>StoryGen Test UI</h1>
    <p class="muted">Dev-only UI to exercise Firebase Functions.</p>

    <label>Idea</label>
    <textarea id="idea" rows="4" placeholder="A lonely robot finds a friend in a city park."></textarea>

    <div class="row">
      <div>
        <label>Genre</label>
        <select id="genre">
          <option>fantasy</option>
          <option>scifi</option>
          <option>mystery</option>
          <option>adventure</option>
          <option selected>general</option>
        </select>
      </div>
      <div>
        <label>Tone</label>
        <select id="tone">
          <option>whimsical</option>
          <option>serious</option>
          <option>humorous</option>
          <option selected>neutral</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Audience</label>
        <select id="audience">
          <option>children</option>
          <option>teens</option>
          <option>adults</option>
          <option selected>general</option>
        </select>
      </div>
      <div>
        <label>Image Style</label>
        <select id="style">
          <option selected>realistic</option>
          <option>cartoon</option>
          <option>watercolor</option>
          <option>comic</option>
          <option>oil painting</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Scenes</label>
        <input id="numScenes" type="number" value="4" min="1" max="10" />
      </div>
      <div style="display:flex; align-items:end;">
        <button id="go">Generate Story + Images</button>
      </div>
    </div>

    <div id="status" class="muted"></div>
    <div id="output" class="scenes"></div>

    <script>
      const $ = (id) => document.getElementById(id);
      const statusEl = $("status");
      const outEl = $("output");

      function setStatus(t) { statusEl.textContent = t; }

      async function call(path, body) {
        const res = await fetch(path, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });
        if (!res.ok) throw new Error(await res.text());
        return res.json();
      }

      $("go").onclick = async () => {
        outEl.innerHTML = "";
        setStatus("Generating...");
        const idea = $("idea").value.trim();
        const payload = {
          idea,
          genre: $("genre").value,
          tone: $("tone").value,
          audience: $("audience").value,
          numScenes: parseInt($("numScenes").value, 10) || 4,
          style: $("style").value
        };
        try {
          const resp = await call("/api/generateAll", payload);
          setStatus(`Done. Story ID: ${resp.storyId}`);
          const scenes = resp.scenes || [];
          for (const s of scenes) {
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
              <div class="muted">Scene ${s.index + 1}</div>
              <p>${s.text}</p>
              ${s.imageUrl ? `<img class="img" src="${s.imageUrl}" />` : ""}
              ${s.imagePrompt ? `<div class="muted">Prompt: ${s.imagePrompt}</div>` : ""}
            `;
            outEl.appendChild(card);
          }
        } catch (e) {
          console.error(e);
          setStatus("Error: " + e.message);
        }
      };
    </script>
  </body>
</html>